@startuml Xem lịch sử mua hàng
title Biểu đồ tuần tự - Xem lịch sử mua hàng

actor "Quản trị viên" as Admin
participant "Trình duyệt" as Browser
participant "CustomerController" as Controller
participant "Customer Model" as CustomerModel
participant "Order Model" as OrderModel
participant "Database" as DB

Admin -> Browser: Truy cập trang quản lý khách hàng
Browser -> Controller: GET /customers
Controller -> CustomerModel: getAllCustomers()
CustomerModel -> DB: SELECT * FROM customers
DB -> CustomerModel: Trả về danh sách khách hàng
CustomerModel -> Controller: Trả về customers
Controller -> Browser: Hiển thị danh sách khách hàng

Admin -> Browser: Chọn khách hàng cần xem lịch sử
Browser -> Controller: GET /customers/{id}/purchase-history

Controller -> CustomerModel: findById(customerId)
CustomerModel -> DB: SELECT * FROM customers WHERE id = ?
DB -> CustomerModel: Trả về thông tin khách hàng
CustomerModel -> Controller: Trả về customer

Controller -> OrderModel: getCustomerOrders(customerId)
OrderModel -> DB: SELECT * FROM orders WHERE customer_id = ?
DB -> OrderModel: Trả về danh sách đơn hàng
OrderModel -> Controller: Trả về orders

Controller -> Browser: Hiển thị lịch sử mua hàng
Browser -> Admin: Hiển thị thông tin khách hàng và danh sách đơn hàng

Admin -> Browser: Chọn đơn hàng để xem chi tiết
Browser -> Controller: GET /orders/{id}
Controller -> OrderModel: getOrderDetails(orderId)
OrderModel -> DB: SELECT order và order_items
DB -> OrderModel: Trả về chi tiết đơn hàng
OrderModel -> Controller: Trả về order details
Controller -> Browser: Hiển thị chi tiết đơn hàng
Browser -> Admin: Hiển thị thông tin chi tiết đơn hàng

@enduml
