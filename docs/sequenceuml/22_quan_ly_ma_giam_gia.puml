@startuml Quản lý mã giảm giá
title Biểu đồ tuần tự - Quản lý mã giảm giá

actor "Quản trị viên" as Admin
participant "Trình duyệt" as Browser
participant "PromotionController" as Controller
participant "Promotion Model" as PromotionModel
participant "Database" as DB

Admin -> Browser: Truy cập trang mã giảm giá
Browser -> Controller: GET /coupons
Controller -> PromotionModel: getAllCoupons()
PromotionModel -> DB: SELECT * FROM promotions WHERE type = 'coupon'
DB -> PromotionModel: Trả về danh sách mã giảm giá
PromotionModel -> Controller: Trả về coupons
Controller -> Browser: Hiển thị danh sách mã giảm giá
Browser -> Admin: Hiển thị danh sách mã giảm giá

Admin -> Browser: Nhấn "Tạo mã giảm giá"
Browser -> Controller: GET /coupons/create
Controller -> Browser: Hiển thị form tạo mã

Admin -> Browser: Nhập thông tin mã giảm giá
Admin -> Browser: Nhập mã code và mô tả
Admin -> Browser: Nhập giá trị giảm giá
Admin -> Browser: Chọn thời gian hiệu lực
Admin -> Browser: Nhấn "Lưu"
Browser -> Controller: POST /coupons

Controller -> Controller: Kiểm tra dữ liệu

alt Dữ liệu hợp lệ
    Controller -> PromotionModel: Tạo mã giảm giá mới
    PromotionModel -> DB: INSERT INTO promotions
    DB -> PromotionModel: Xác nhận tạo thành công
    PromotionModel -> Controller: Trả về mã đã tạo
    
    Controller -> Browser: Thông báo thành công
    Browser -> Admin: Hiển thị "Tạo mã giảm giá thành công"
    
else Dữ liệu không hợp lệ
    Controller -> Browser: Thông báo lỗi
    Browser -> Admin: Hiển thị thông báo lỗi
end

Admin -> Browser: Xem thống kê mã giảm giá
Browser -> Controller: GET /coupons/{id}/stats
Controller -> PromotionModel: getCouponStats(couponId)
PromotionModel -> DB: SELECT usage data
DB -> PromotionModel: Trả về thống kê
PromotionModel -> Controller: Trả về stats
Controller -> Browser: Hiển thị thống kê
Browser -> Admin: Hiển thị số lượt sử dụng và doanh thu

@enduml
